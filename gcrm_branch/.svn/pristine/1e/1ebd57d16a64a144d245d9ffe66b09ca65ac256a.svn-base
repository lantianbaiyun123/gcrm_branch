define(["app","../_common/ytCommon","../_services/PageSet","../_services/http/BenchmarkPrice","../record/BenchmarkPriceApprovalRecord","../_directives/ytPopoverConfirm"],function(t){t.registerController("CtrlBenchmarkPriceDetail",["$scope","$stateParams","$log","PageSet","BenchmarkPrice","BenchmarkPriceApprovalRecord",function(t,i,n,a,o,e){function s(){o.getDetail({quotationMainId:t.quotationMainId}).success(function(t){200===t.code&&t.data&&u(t.data)})}function u(i){if(t.IS_OWNER=i.quotationMainVO.isOwner,t.quotationMain=i.quotationMainVO.quotationMain,t.quotationMain.platformName=i.quotationMainVO.platformName,t.quotationMain.siteName=i.quotationMainVO.siteName,t.quotationMain.createrName=i.quotationMainVO.createrName,t.msgs.detailAlerts=[],i.quotationMainVO.taskInfoMessage){var n={type:"info",msg:i.quotationMainVO.taskInfoMessage};"CANCEL"===t.quotationMain.approveStatus&&(n.type="danger"),t.msgs.detailAlerts.push(n)}t.quotationList=[{}],d[t.quotationMain.priceType](i.quotationViewList[0].quotationList),t.quotationList[0].quotationMaterialList=i.quotationViewList[0].quotationMaterialList,t.quotationList[0].siteId=t.quotationMain.siteId,"INVALID"!=t.quotationMain.status||"SAVING"!=t.quotationMain.approveStatus&&"CANCEL"!=t.quotationMain.approveStatus||r()}function r(){var i=c();t.quotationMain.startTime<i&&(t.quotationMain.startTime=i),t.quotationMain.endTime<i&&(t.quotationMain.endTime="")}function c(){var t=new Date,i=new Date(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate());return i.getTime()}a.set({activeIndex:1,siteName:"benchmarkPriceDetail"}),t.quotationMainId=i.id,t.isEdit=!0,t.closeMsg=function(i){t.msgs.detailAlerts.splice(i,1)},t.modalApprovalRecord=function(){e.show(t.quotationMainId)},t.withdrawPrice=function(){o.withdraw({quotationMainId:t.quotationMainId,returnType:1}).success(function(t){200===t.code&&t.data&&u(t.data)})},t.nullifyPrice=function(){o.nullify({quotationMainId:t.quotationMainId,returnType:1}).success(function(t){200===t.code&&t.data&&u(t.data)})};var d={initCps:function(){t.quotationList[0].unit={},t.quotationList[0].unit.cps=[{}],t.quotationList[0].isUnifyedCPS=!0;for(var i in t.constant.industryType){var n={};for(var a in t.constant.industryType[i])n[a]=t.constant.industryType[i][a];t.quotationList[0].unit.cps.push(n)}},unit:function(i){t.quotationList[0].unit={},t.quotationList[0].unit.cps=[{}];var n={},a=1;for(var o in t.constant.industryType){var e=t.constant.industryType[o].industryTypeName,s=t.constant.industryType[o].parentId;n[o]=a++,t.quotationList[0].unit.cps.push({industryId:o,industryTypeName:e,parentId:s})}for(var u=i.length,r=0;u>r;r++){var c=t.constant.billingModel[i[r].billingModelId].name.toLowerCase();"cps"===c?i[r].industryId>=0?(t.quotationList[0].unit.cps[n[i[r].industryId]].id=i[r].id,t.quotationList[0].unit.cps[n[i[r].industryId]].value=i[r].ratioMine):(t.quotationList[0].isUnifyedCPS=!0,t.quotationList[0].unit.cps[0].value=i[r].ratioMine):(t.quotationList[0].unit[c]={},t.quotationList[0].unit[c].id=i[r].id,t.quotationList[0].unit[c].value=i[r].publishPrice)}},ratio:function(i){t.quotationList[0].ratio={},t.quotationList[0].ratio.id=i[0].id,t.quotationList[0].ratio.ratioMine=i[0].ratioMine,t.quotationList[0].ratio.ratioCustomer=i[0].ratioCustomer,t.quotationList[0].ratio.ratioThird=i[0].ratioThird,this.initCps()},rebate:function(i){t.quotationList[0].rebate={},t.quotationList[0].rebate.id=i[0].id,t.quotationList[0].rebate.ratioRebate=i[0].ratioRebate,this.initCps()}};t.constantIsSet?s():t.$on("constantReady",function(){s(),t.constantIsSet=!0})}])});