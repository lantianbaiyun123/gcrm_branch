define(["app"],function(e){!function(){"use strict";e.registerValue("treeConfig",{treeClass:"angular-ui-tree",emptyTreeClass:"angular-ui-tree-empty",hiddenClass:"angular-ui-tree-hidden",nodesClass:"angular-ui-tree-nodes",nodeClass:"angular-ui-tree-node",handleClass:"angular-ui-tree-handle",placeHolderClass:"angular-ui-tree-placeholder",dragClass:"angular-ui-tree-drag",dragThreshold:3,levelThreshold:30})}(),function(){"use strict";e.registerFactory("$uiTreeHelper",["$document","$window",function(e,n){return{nodrag:function(e){return"undefined"!=typeof e.attr("data-nodrag")},eventObj:function(e){var n=e;return void 0!==e.targetTouches?n=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(n=e.originalEvent.targetTouches.item(0)),n},dragInfo:function(e){return{source:e,sourceInfo:{nodeScope:e,index:e.index(),nodesScope:e.$parentNodesScope},index:e.index(),siblings:e.siblings().slice(0),parent:e.$parentNodesScope,moveTo:function(e,n,t){this.parent=e,this.siblings=n.slice(0);var o=this.siblings.indexOf(this.source);o>-1&&(this.siblings.splice(o,1),this.source.index()<t&&t--),this.siblings.splice(t,0,this.source),this.index=t},parentNode:function(){return this.parent.$nodeScope},prev:function(){return this.index>0?this.siblings[this.index-1]:null},next:function(){return this.index<this.siblings.length-1?this.siblings[this.index+1]:null},isDirty:function(){return this.source.$parentNodesScope!=this.parent||this.source.index()!=this.index},eventArgs:function(e,n){return{source:this.sourceInfo,dest:{index:this.index,nodesScope:this.parent},elements:e,pos:n}},apply:function(){var e=this.source.$modelValue;this.source.remove(),this.parent.insertNode(this.index,e)}}},height:function(e){return e.prop("scrollHeight")},width:function(e){return e.prop("scrollWidth")},offset:function(t){var o=t[0].getBoundingClientRect();return{width:t.prop("offsetWidth"),height:t.prop("offsetHeight"),top:o.top+(n.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:o.left+(n.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}},positionStarted:function(e,n){var t={};return t.offsetX=e.pageX-this.offset(n).left,t.offsetY=e.pageY-this.offset(n).top,t.startX=t.lastX=e.pageX,t.startY=t.lastY=e.pageY,t.nowX=t.nowY=t.distX=t.distY=t.dirAx=0,t.dirX=t.dirY=t.lastDirX=t.lastDirY=t.distAxX=t.distAxY=0,t},positionMoved:function(e,n,t){n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=e.pageX,n.nowY=e.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:n.distX>0?1:-1,n.dirY=0===n.distY?0:n.distY>0?1:-1;var o=Math.abs(n.distX)>Math.abs(n.distY)?1:0;return t?(n.dirAx=o,void(n.moving=!0)):(n.dirAx!==o?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),void(n.dirAx=o))}}}])}(),function(){"use strict";e.registerController("TreeController",["$scope","$element","$attrs","treeConfig",function(e,n){this.scope=e,e.$element=n,e.$nodesScope=null,e.$type="uiTree",e.$emptyElm=null,e.$callbacks=null,e.dragEnabled=!0,e.maxDepth=0,e.isEmpty=function(){return e.$nodesScope&&e.$nodesScope.$modelValue&&0===e.$nodesScope.$modelValue.length},e.place=function(n){e.$nodesScope.$element.append(n),e.$emptyElm.remove()},e.resetEmptyElement=function(){0===e.$nodesScope.$modelValue.length?n.append(e.$emptyElm):e.$emptyElm.remove()};var t=function(e,n){for(var o=e.childNodes(),r=0;r<o.length;r++){n?o[r].collapse():o[r].expand();var i=o[r].$childNodesScope;i&&t(i,n)}};e.collapseAll=function(){t(e.$nodesScope,!0)},e.expandAll=function(){t(e.$nodesScope,!1)}}])}(),function(){"use strict";e.registerController("TreeNodesController",["$scope","$element","$timeout","treeConfig",function(e,n,t){this.scope=e,e.$element=n,e.$modelValue=null,e.$nodeScope=null,e.$treeScope=null,e.$type="uiTreeNodes",e.$nodesMap={},e.nodrop=!1,e.maxDepth=0,e.initSubNode=function(n){t(function(){e.$nodesMap[n.$modelValue.$$hashKey]=n})},e.destroySubNode=function(n){e.$nodesMap[n.$modelValue.$$hashKey]=null},e.accept=function(n,t){return e.$treeScope.$callbacks.accept(n,e,t)},e.isParent=function(n){return n.$parentNodesScope==e},e.hasChild=function(){return e.$modelValue.length>0},e.safeApply=function(e){var n=this.$root.$$phase;"$apply"==n||"$digest"==n?e&&"function"==typeof e&&e():this.$apply(e)},e.removeNode=function(n){var t=e.$modelValue.indexOf(n.$modelValue);return t>-1?(e.safeApply(function(){e.$modelValue.splice(t,1)[0]}),n):null},e.insertNode=function(n,t){e.safeApply(function(){e.$modelValue.splice(n,0,t)})},e.childNodes=function(){var n=[];if(e.$modelValue)for(var t=0;t<e.$modelValue.length;t++)n.push(e.$nodesMap[e.$modelValue[t].$$hashKey]);return n},e.depth=function(){return e.$nodeScope?e.$nodeScope.depth():0},e.outOfDepth=function(n){var t=e.maxDepth||e.$treeScope.maxDepth;return t>0?e.depth()+n.maxSubDepth()+1>t:!1}}])}(),function(){"use strict";e.registerController("TreeNodeController",["$scope","$element","$attrs","treeConfig",function(e,n){this.scope=e,e.$element=n,e.$modelValue=null,e.$parentNodeScope=null,e.$childNodesScope=null,e.$parentNodesScope=null,e.$treeScope=null,e.$handleScope=null,e.$type="uiTreeNode",e.$$apply=!1,e.collapsed=!1,e.init=function(t){var o=t[0];e.$treeScope=t[1]?t[1].scope:null,e.$parentNodeScope=o.scope.$nodeScope,e.$modelValue=o.scope.$modelValue[e.$index],e.$parentNodesScope=o.scope,o.scope.initSubNode(e),n.on("$destroy",function(){o.scope.destroySubNode(e)})},e.index=function(){return e.$parentNodesScope.$modelValue.indexOf(e.$modelValue)},e.dragEnabled=function(){return!(e.$treeScope&&!e.$treeScope.dragEnabled)},e.isSibling=function(n){return e.$parentNodesScope==n.$parentNodesScope},e.isChild=function(n){var t=e.childNodes();return t&&t.indexOf(n)>-1},e.prev=function(){var n=e.index();return n>0?e.siblings()[n-1]:null},e.siblings=function(){return e.$parentNodesScope.childNodes()},e.childNodesCount=function(){return e.childNodes()?e.childNodes().length:0},e.hasChild=function(){return e.childNodesCount()>0},e.childNodes=function(){return e.$childNodesScope?e.$childNodesScope.childNodes():null},e.accept=function(n,t){return e.$childNodesScope&&e.$childNodesScope.accept(n,t)},e.remove=function(){return e.$parentNodesScope.removeNode(e)},e.toggle=function(){e.collapsed=!e.collapsed},e.collapse=function(){e.collapsed=!0},e.expand=function(){e.collapsed=!1},e.depth=function(){var n=e.$parentNodeScope;return n?n.depth()+1:1};var t=0,o=function(e){for(var n=0,r=e.childNodes(),i=0;i<r.length;i++){var l=r[i].$childNodesScope;l&&(n=1,o(l))}t+=n};e.maxSubDepth=function(){return t=0,e.$childNodesScope&&o(e.$childNodesScope),t}}])}(),function(){"use strict";e.registerController("TreeHandleController",["$scope","$element","$attrs","treeConfig",function(e,n){this.scope=e,e.$element=n,e.$nodeScope=null,e.$type="uiTreeHandle"}])}(),function(){"use strict";e.registerDirective("uiTree",["treeConfig","$window",function(e,n){return{restrict:"A",scope:!0,controller:"TreeController",link:function(t,o,r){var i={accept:null},l={};angular.extend(l,e),l.treeClass&&o.addClass(l.treeClass),t.$emptyElm=angular.element(n.document.createElement("div")),l.emptyTreeClass&&t.$emptyElm.addClass(l.emptyTreeClass),t.$watch("$nodesScope.$modelValue.length",function(){t.$nodesScope.$modelValue&&t.resetEmptyElement()},!0),t.$watch(function(){return t.$eval(r.dragEnabled)},function(e){"boolean"==typeof e&&(t.dragEnabled=e)},!0),t.$watch(function(){return t.$eval(r.maxDepth)},function(e){"number"==typeof e&&(t.maxDepth=e)},!0),i.accept=function(e,n){return n.nodrop||n.outOfDepth(e)?!1:!0},i.dropped=function(){},i.dragStart=function(){},i.dragMove=function(){},i.dragStop=function(){},t.$watch(r.uiTree,function(e){angular.forEach(e,function(e,n){i[n]&&"function"==typeof e&&(i[n]=e)}),t.$callbacks=i},!0)}}}])}(),function(){"use strict";e.registerDirective("uiTreeNodes",["treeConfig","$window",function(e){return{require:["ngModel","?^uiTreeNode","^uiTree"],restrict:"A",scope:!0,controller:"TreeNodesController",link:function(n,t,o,r){var i={};angular.extend(i,e),i.nodesClass&&t.addClass(i.nodesClass);var l=r[0],a=r[1],s=r[2];a?(a.scope.$childNodesScope=n,n.$nodeScope=a.scope):s.scope.$nodesScope=n,n.$treeScope=s.scope,l&&(l.$render=function(){n.$modelValue=l.$modelValue}),n.$watch(function(){return n.$eval(o.maxDepth)},function(e){"number"==typeof e&&(n.maxDepth=e)},!0),n.$watch(function(){return o.nodrop},function(e){"undefined"!=typeof e&&(n.nodrop=!0)},!0)}}}])}(),function(){"use strict";e.registerDirective("uiTreeNode",["treeConfig","$uiTreeHelper","$window","$document",function(e,n,t,o){return{require:["^uiTreeNodes","^uiTree"],restrict:"A",controller:"TreeNodeController",link:function(r,i,l,a){var s={};angular.extend(s,e),s.nodeClass&&i.addClass(s.nodeClass),r.init(a);var d,c,u,p,f,$,h,m="ontouchstart"in window,g=null,v=function(e){if((m||2!=e.button&&3!=e.which)&&!(e.uiTreeDragging||e.originalEvent&&e.originalEvent.uiTreeDragging)){var l=angular.element(e.target),a=l.scope();if(a&&a.$type&&!("uiTreeNode"!=a.$type&&"uiTreeHandle"!=a.$type||"uiTreeNode"==a.$type&&a.$handleScope)){for(;l&&l[0]&&l[0]!=i;){if(n.nodrag(l))return;l=l.parent()}e.uiTreeDragging=!0,e.originalEvent&&(e.originalEvent.uiTreeDragging=!0),e.preventDefault();var g=n.eventObj(e);d=!0,c=n.dragInfo(r);var v=r.$element.prop("tagName");if("tr"===v.toLowerCase()){p=angular.element(t.document.createElement(v));var S=angular.element(t.document.createElement("td")).addClass(s.placeHolderClass);p.append(S)}else p=angular.element(t.document.createElement(v)).addClass(s.placeHolderClass);f=angular.element(t.document.createElement(v)),s.hiddenClass&&f.addClass(s.hiddenClass),u=n.positionStarted(g,r.$element),p.css("height",n.height(r.$element)+"px"),$=angular.element(t.document.createElement(r.$parentNodesScope.$element.prop("tagName"))).addClass(r.$parentNodesScope.$element.attr("class")).addClass(s.dragClass),$.css("width",n.width(r.$element)+"px"),$.css("z-index",9999),r.$element.after(p),r.$element.after(f),$.append(r.$element),o.find("body").append($),$.css({left:g.pageX-u.offsetX+"px",top:g.pageY-u.offsetY+"px"}),h={placeholder:p,dragging:$},r.$apply(function(){r.$callbacks.dragStart(c.eventArgs(h,u))}),angular.element(o).bind("touchend",y),angular.element(o).bind("touchcancel",y),angular.element(o).bind("touchmove",x),angular.element(o).bind("mouseup",y),angular.element(o).bind("mousemove",x),angular.element(t.document.body).bind("mouseleave",C)}}},S=function(e){var o,i=n.eventObj(e);if($){if(e.preventDefault(),$.css({left:i.pageX-u.offsetX+"px",top:i.pageY-u.offsetY+"px"}),n.positionMoved(e,u,d),d)return void(d=!1);if(u.dirAx&&u.distAxX>=s.levelThreshold&&(u.distAxX=0,u.distX>0&&(o=c.prev(),o&&!o.collapsed&&o.accept(r,o.childNodesCount())&&(o.$childNodesScope.$element.append(p),c.moveTo(o.$childNodesScope,o.childNodes(),o.childNodesCount()))),u.distX<0)){var l=c.next();if(!l){var a=c.parentNode();a&&a.$parentNodesScope.accept(r,a.index()+1)&&(a.$element.after(p),c.moveTo(a.$parentNodesScope,a.siblings(),a.index()+1))}}var f=(n.offset($).left-n.offset(p).left>=s.threshold,i.pageX-t.document.body.scrollLeft),m=i.pageY-(window.pageYOffset||t.document.documentElement.scrollTop);angular.isFunction($.hide)&&$.hide(),t.document.elementFromPoint(f,m);var v=angular.element(t.document.elementFromPoint(f,m));if(angular.isFunction($.show)&&$.show(),!u.dirAx){var S,N;N=v.scope();var b=!1;if("uiTree"==N.$type&&N.dragEnabled&&(b=N.isEmpty()),"uiTreeHandle"==N.$type&&(N=N.$nodeScope),"uiTreeNode"!=N.$type&&!b)return;if(g&&p.parent()[0]!=g.$element[0]&&(g.resetEmptyElement(),g=null),b)g=N,N.$nodesScope.accept(r,0)&&(N.place(p),c.moveTo(N.$nodesScope,N.$nodesScope.childNodes(),0));else if(N.dragEnabled()){v=N.$element;var x=n.offset(v);S=i.pageY<x.top+n.height(v)/2,N.$parentNodesScope.accept(r,N.index())?S?(v[0].parentNode.insertBefore(p[0],v[0]),c.moveTo(N.$parentNodesScope,N.siblings(),N.index())):(v.after(p),c.moveTo(N.$parentNodesScope,N.siblings(),N.index()+1)):!S&&N.accept(r,N.childNodesCount())&&(N.$childNodesScope.$element.append(p),c.moveTo(N.$childNodesScope,N.childNodes(),N.childNodesCount()))}}r.$apply(function(){r.$callbacks.dragMove(c.eventArgs(h,u))})}},N=function(e){e.preventDefault(),$&&(f.replaceWith(r.$element),p.remove(),$.remove(),$=null,r.$$apply?(c.apply(),r.$treeScope.$apply(function(){r.$callbacks.dropped(c.eventArgs(h,u))})):T(),r.$treeScope.$apply(function(){r.$callbacks.dragStop(c.eventArgs(h,u))}),r.$$apply=!1,c=null),angular.element(o).unbind("touchend",y),angular.element(o).unbind("touchcancel",y),angular.element(o).unbind("touchmove",x),angular.element(o).unbind("mouseup",y),angular.element(o).unbind("mousemove",x),angular.element(t.document.body).unbind("mouseleave",C)},b=function(e){r.dragEnabled()&&"input"!==angular.lowercase(e.target.tagName)&&v(e)},x=function(e){S(e)},y=function(e){r.$$apply=!0,N(e)},C=function(e){N(e)},T=function(){i.bind("touchstart",b),i.bind("mousedown",b)};T(),angular.element(t.document.body).bind("keydown",function(e){27==e.keyCode&&(r.$$apply=!1,N(e))})}}}])}(),function(){"use strict";e.registerDirective("uiTreeHandle",["treeConfig","$window",function(e){return{require:"^uiTreeNode",restrict:"A",scope:!0,controller:"TreeHandleController",link:function(n,t,o,r){var i={};angular.extend(i,e),i.handleClass&&t.addClass(i.handleClass),n!=r.scope&&(n.$nodeScope=r.scope,r.scope.$handleScope=n)}}}])}()});