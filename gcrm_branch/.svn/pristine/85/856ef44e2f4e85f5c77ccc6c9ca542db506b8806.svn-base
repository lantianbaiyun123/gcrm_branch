define(["app","../_common/ytCommon","../_directives/ytInputDropdown","./CtrlAddUser","./CtrlAddDataAuthority"],function(e){e.registerController("CtrlAdminUserList",["$scope","$timeout","User","PageSet","$modal","$state","$window","Modal","STATIC_DIR",function(e,t,a,n,r,o,u,s,i){n.set({siteName:"adminUserList",activeIndex:6}),e.q={},a.getRoleList().success(function(t){200===t.code&&(e.q.roleTypes=t.data.allRoles)});var d={initQuery:function(){e.q={},e.pager={pageNumber:1,pageSize:10,pageSizeSlots:[10,20,30,50],totalCount:0},t(function(){d.doQuery()})},doQuery:function(){a.getList(this.getQueryParams()).success(function(t){200===t.code&&(e.userList=t.data.content,e.pager.totalCount=t.data.totalCount,e.pager.totalPages=t.data.totalPages)})},getQueryParams:function(){var t={realName:e.q.realName,email:e.q.email,ucName:e.q.ucName,pageSize:e.pager.pageSize,pageNumber:e.pager.pageNumber};return e.q.roleType&&(t.roleId=e.q.roleType.id),t},resetPageNumber:function(){e.pager.pageNumber=1},dateFormat:"yyyy-MM-dd"};d.initQuery(),e.$watch("pager.pageNumber",function(e,t){e&&t&&e!==t&&d.doQuery()}),e.btnQuery=function(){d.resetPageNumber(),d.doQuery()},e.setPageSize=function(t){e.pager.pageSize=t,d.resetPageNumber(),d.doQuery()},e.btnAddUser=function(){var e=r.open({templateUrl:i+"app/admin/addUser.tpl.html",controller:"CtrlAddUser",resolve:{opts:function(){return{type:"add"}}}});e.result.then(function(){d.doQuery()})},e.btnDisable=function(e){a.disable({ucId:e.ucId,status:e.status}).success(function(e){200===e.code&&(d.doQuery(),s.success({content:"已作废"}))})},e.btnEnable=function(e){a.enable({ucId:e.ucId,status:e.status}).success(function(e){200===e.code&&(d.doQuery(),s.success({content:"已启用"}))})},e.navToUserDetail=function(e){u.open("#/userDetail?ucId="+e.ucId)},e.btnAddDataAuthority=function(e){var t=r.open({templateUrl:i+"app/admin/addDataAuthorityModal.tpl.html",controller:"CtrlAddDataAuthority",resolve:{opts:function(){return{type:"add",username:e.ucName}}}});t.result.then(function(){d.doQuery()})}}])});