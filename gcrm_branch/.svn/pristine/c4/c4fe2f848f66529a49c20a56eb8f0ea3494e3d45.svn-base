define(["app"],function(e){e.registerFactory("Customer",["$http","APP_CONTEXT","$filter","Utils",function(e,t,n,r){function o(n){return e({method:"get",url:t+"customer/belongSalesSuggest",params:n})}function u(n){return e({method:"get",url:t+"customer/agentCompanySuggest",params:n})}return{getSuggest:function(n,r){e({method:"get",url:t+"adbaseinfo/customersSuggest",params:n}).then(function(e){r(e.data.data)})},getSuggestForAdOwner:function(n,r){e({method:"get",url:t+"adsolution/content/customersSuggest",params:n}).then(function(e){r(e.data.data)})},getSuggestPromise:function(t){return e({method:"get",url:"/gcrm/adbaseinfo/customersSuggest",params:t}).then(function(e){return e.data.data})},get:function(t){return e({method:"get",url:"/gcrm/adbaseinfo/queryCustomer",params:t})},getListQueryView:function(){return e({method:"get",url:t+"customer/initQueryView"})},getList:function(n){return e({method:"post",url:t+"customer/query",data:angular.toJson(n)})},salesTransfer:function(n){return e({method:"get",url:t+"customer/updateSales/"+n.customerId+"/"+n.salesId})},getAccountDetail:function(n){return e({method:"get",url:t+"account/edit/"+n.accountId})},validateEmail:function(n){return e({method:"post",url:t+"account/sendVerifyCode",data:angular.toJson(n)})},validateVerCode:function(n){return e({method:"post",url:t+"account/verifyEmail",data:angular.toJson(n)})},submitUserName:function(n){return e({method:"post",url:t+"account/saveAccount",data:angular.toJson(n)})},sendReminder:function(n){return e({method:"get",url:t+"customer/reminders/"+n.customerId,params:n})},withdraw:function(n){return e({method:"get",url:t+"customer/withdrawCustomer/"+n.customerId,params:n})},nullify:function(n){return e({method:"get",url:t+"customer/discardCustomer/"+n.customerId})},recover:function(n){return e({method:"post",url:t+"customer/recoveryCustomer",data:angular.toJson(n)})},getApprovalInfo:function(n){return e({method:"post",url:t+"customer/approveview",data:angular.toJson(n)})},submitApproval:function(n){return e({method:"post",url:t+"customer/approve",data:angular.toJson(n)})},approvalRecord:function(n){return e({method:"get",url:t+"customer/findApproveRecord",params:n})},modifyRecord:function(n){return e({method:"get",url:t+"customer/findModifyRecord",params:n})},getDetail:function(n){return e({method:"get",url:t+"customer/showCustomerDetailInfo/"+n.id})},getEditInfo:function(){return e({method:"get",url:t+"customer/init"})},queryAgentCountries:function(n){return e({method:"get",url:t+"customer/getAgentRegional/"+n.id})},getBelongSalesSuggestOption:function(e){var t=n("translate");return{id:function(e){return e.id},placeholder:t("SELECTTOSUGGEST_BELONG_SALES"),minimumInputLength:1,formatInputTooShort:function(e,n){return t("SELECTTOSUGGEST_INPUT_MINIMAL_HINT",{minLength:n})},formatNoMatches:function(){return t("SELECTTOSUGGEST_NO_BELONG_SALES")},query:function(e){var t={results:[]};o({query:$.trim(e.term)}).success(function(n){200===n.code&&(t.results=n.data,e.callback(t))})},formatResult:function(e){return e.name},formatSelection:function(t){return e&&e.cbfn&&e.cbfn(t),t.name},width:"element",allowClear:function(){return e&&e.allowClear?e.allowClear:!1}(),initSelection:function(){}}},saveToApprove:function(n){return e({method:"post",url:t+"customer/submit",data:angular.toJson(n)})},save:function(n){return e({method:"post",url:t+"customer/tempSaveCustomer",data:angular.toJson(n)})},getBelongSalesLeader:function(n){return e({method:"get",url:t+"customer/belongSalesLeader",params:n})},addAgentCompany:function(n){return e({method:"post",url:t+"customer/addAgent",data:angular.toJson(n)})},getAgentCompanySuggestOption:function(e){var t=n("translate");return{id:function(e){return e.id},placeholder:t("SELECTTOSUGGEST_BELONG_AGENT"),minimumInputLength:1,formatInputTooShort:function(e,n){return t("SELECTTOSUGGEST_INPUT_MINIMAL_HINT",{minLength:n})},formatNoMatches:function(){return t("SELECTTOSUGGEST_NO_BELONG_AGENT")},query:function(e){var t={results:[]};u({query:$.trim(e.term)}).success(function(n){200===n.code&&(t.results=n.data,e.callback(t))})},formatResult:function(e){return e.name},formatSelection:function(e){return e.name},width:"element",allowClear:function(){return e&&e.allowClear?e.allowClear:!1}(),initSelection:function(){}}},saveBasic:function(n){return e({method:"post",url:t+"customer/updateCustomer",data:angular.toJson({customer:n})})},saveContactor:function(n){return e({method:"post",url:t+"customer/saveOrUpdateContactPerson",data:angular.toJson(n)})},removeContactor:function(n){return e({method:"post",url:t+"customer/deleteContactPerson",data:angular.toJson(n)})},resolveBasicData:function(e){return e=angular.copy(e),e.businessType=e.businessTypesSelected&&e.businessTypesSelected.join(),e.industry=e.industry&&e.industry.id,e.belongSales=e.belongSales&&e.belongSales.id,e.agentCountrySelected&&e.agentCountrySelected.length&&(e.agentCountry=r.joinWithKey(e.agentCountrySelected,"id")),e.currencyType=e.currencyType&&e.currencyType.id,e.belongManager=e.belongManager&&e.belongManager.id,e.belongManager&&(e.belongManager=~~e.belongManager),e.country=e.country&&e.country.id,e.registerTime=n("date")(e.registerTime,"yyyy-MM-dd"),e.agentRegional&&e.agentRegional.id&&(e.agentRegional=e.agentRegional.id),e.agentCompany&&e.agentCompany.id&&(e.agentCompany=e.agentCompany.id),delete e.agentRegionalShow,delete e.businessTypesSelected,delete e.customerTypes,delete e.industryTypes,delete e.companySizeTypes,delete e.currencyTypes,delete e.businessTypes,delete e.agentTypes,delete e.agentRegionals,delete e.agentCountries,delete e.agentCountrySelected,e},resolveContactData:function(e){for(var t=[],n=0;n<e.length;n++)if(e[n].name){var r=angular.copy(e[n]);delete r.isEditing,t.push(r)}return t},resolveOpportunityData:function(e){return e=angular.copy(e),e.currencyType=e.currencyType&&e.currencyType.id,e.businessTypesSelected&&e.businessTypesSelected.length&&(e.businessType=e.businessTypesSelected.join()),e.billingModelsSelected&&e.billingModelsSelected.length&&(e.billingModel=e.billingModelsSelected.join()),e.platformsSelected&&(e.platformIds=r.joinWithKey(e.platformsSelected,"id")),delete e.payTypes,delete e.billingModels,delete e.currencyTypes,delete e.businessTypes,delete e.businessTypesSelected,delete e.billingModelsSelected,delete e.platformsSelected,delete e.platforms,e},updateCustomerOpportunity:function(n){return e({method:"post",url:t+"customer/updateOpportunity",data:angular.toJson(n)})},updateCustomerQualification:function(n){return e({method:"post",url:t+"customer/updateQualification",data:angular.toJson(n)})},saveOrUpdateAttachment:function(n){return e({method:"post",url:t+"customer/saveOrUpdateAttachment",data:angular.toJson(n)})},removeAttachment:function(n){return e({method:"post",url:t+"customer/deleteAttachment",data:angular.toJson(n)})},queryAccountList:function(n){return e({method:"get",url:t+"account/query/"+n.customerNumber})},removeAccount:function(n){return e({method:"get",url:t+"account/delete/"+n.accountId})},updateAccount:function(n){return e({method:"get",url:t+"account/updateState",params:n})},queryContractList:function(n){return e({method:"post",url:t+"customer/queryContract",data:angular.toJson(n)})}}}])});