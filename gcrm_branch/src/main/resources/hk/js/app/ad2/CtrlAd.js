define(["app","anuglar-ui-select2","../_common/ytCommon","./ServiceAd","./ModalPO","../record/SolutionApprovalRecord"],function(n){n.registerController("CtrlAd",["$scope","$state","$stateParams","$filter","$window","$modal","GCRMUtil","AdConstant","AdSolution","AdHttp","AdBasic","AdContent","AdContentUtil","Modal","ModalPO",function(n,t,o,c,e,i,d,a,s,u,r,l,f,C,A){function S(t){A.show({type:t,customerNumber:n.basic.customerI18nView.customer.customerNumber,adSolutionId:o.id}).then(function(n){n&&n.type&&("direct"===n.type?n.data?C.success({content:a.POSuccess},function(){e.location.reload()}):b():n.data?e.location.reload():b())})}function b(){u.createSingleContract({id:o.id}).success(function(n){200===n.code&&n.data&&C.success({content:a.btnContractTypeSuccess},function(){e.location.reload()})})}n.AdConstant=a,s.init(n,o.id),n.closeAlert=function(t){"info"===n.alerts[t].type&&n.alerts.splice(t,1)},n.basicEdit=function(){r.edit(n)},n.addAdContents=function(){s.addContent(n);var t=n.adContents.length-1;n.anchorTo("anchorContent"+t)},n.btnSubmitAdSolution=function(){u.submit({id:o.id}).success(function(t){if(200===t.code)C.alert({content:c("translate")("AD_BASIC_ALERT_SUBMIT_SUCCESS")},function(){e.location.reload()});else if(204===t.code){for(var o=[],i=0;i<t.errorList.length;i++)o.push(d.translate(t.errorList[i].key,f.resolveErrorArgsForAdContent(n,t.errorList[i].args)));C.alert({contentList:o})}})},n.btnAdSolutionChange=function(){u.changeAdSolution({id:o.id}).success(function(n){200===n.code&&t.go("ad2.facade.facade",{id:n.data.adSolution.id})})},n.btnAdModify=function(){u.modifyAd({id:o.id}).success(function(n){200===n.code&&e.location.reload()})},n.btnCancelAdSolution=function(){u.cancelAd({id:o.id}).success(function(n){200===n.code&&C.success({content:a.successAdCancel},function(){e.location.reload()})})},n.btnContractType=function(n,t){"single"===n?b():t?u.createSingleContract({id:o.id}).success(function(n){200===n.code&&C.success({content:a.btnContractTypeSuccess},function(){e.location.reload()})}):S(n)},n.btnCancelSingle=function(){u.revokeContract({id:o.id}).success(function(n){200===n.code&&C.success({content:a.successSingleCancel},function(){e.location.reload()})})},n.btnCreatePO=function(){u.findContactPO({id:o.id}).success(function(n){200===n.code&&(n.data?C.success({content:a.btnCreatePOSuccess},function(){e.location.reload()}):S("direct"))})},n.btnViewCanceled=function(n){e.open("#/adContentDetail?id="+n.adSolutionContentId)},n.cancelChangeAd=function(){return o.id?void u.cancelChangeAdSolution({id:o.id}).success(function(n){200===n.code&&t.go("ad2.facade.facade",{id:n.data})}):!1}}])});