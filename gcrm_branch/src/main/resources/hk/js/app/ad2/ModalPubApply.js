define(["app","../_services/Select2Suggest"],function(t){t.registerFactory("ModalPubApply",["$modal","$q","STATIC_DIR",function(t,a,e){return{applyView:function(n){var l=a.defer(),o=t.open({templateUrl:e+"app/ad2/ModalPubApply.tpl.html",controller:"CtrlModalPubApply",windowClass:"modal-pub-apply",backdrop:"static",resolve:{opts:function(){return n}}});return o.result.then(function(t){l.resolve(t)}),l.promise},detailView:function(n){var l=a.defer(),o=t.open({templateUrl:e+"app/ad2/ModalPubApplyDetail.tpl.html",controller:"CtrlModalPubApplyDetail",windowClass:"modal-pub-apply",resolve:{opts:function(){return n}}});return o.result.then(function(t){l.resolve(t)}),l.promise}}}]),t.registerController("CtrlModalPubApply",["$scope","$modalInstance","$filter","Modal","opts","ContractSuggest","AdHttp",function(t,a,e,n,l,o,p){t.applyData=l,t.apply={attachments:[]},l.contractNumber&&(t.apply.contract={data:{number:l.contractNumber}}),t.apply.customerContract=o.getContractOption({basic:{customerSelected:{data:l.customerNumber}}}),t.ok=function(e){if(t.apply.submitDisabled=!0,e.$valid&&t.apply.attachments.length){t.applyData.contractNumber=t.apply.contract.data.number;var n=p.pubApplySubmit({adSolutionContentApply:t.applyData,attachments:t.apply.attachments});n.success(function(t){200===t.code&&a.close({btnType:"ok",response:t})}),n["finally"](function(){t.apply.submitDisabled=!1})}else t.apply.submitDisabled=!1},t.cancel=function(){a.dismiss("cancel")},t.removeAttachment=function(a){t.apply.attachments.splice(a,1)},t.beginUpload=function(){t.apply.submitDisabled=!0},t.uploaded=function(){t.apply.submitDisabled=!1}}]),t.registerController("CtrlModalPubApplyDetail",["$scope","$modalInstance","$filter","Modal","opts","AdHttp",function(t,a,e,n,l,o){t.applyDetail=l.applyDetail,console.log(t.applyDetail),t.cancel=function(){a.dismiss("cancel")},t.pubApplyWithdraw=function(){o.pubApplyWithdraw({applyId:l.applyDetail.adSolutionContentApply.id}).success(function(t){n.success({content:e("translate")("SUCCESS_WITHDRAW"),timeOut:2e3},function(){a.close({btnType:"withdraw",response:t})})})},t.pubApplyReminder=function(){o.pubApplyReminder({applyId:l.applyDetail.adSolutionContentApply.id}).success(function(t){200===t.code&&n.success({content:e("translate")("SUCCESS_REMIDER"),timeOut:2e3})})}}]),t.registerFactory("ContractSuggest",["$http","$filter","APP_CONTEXT","Contract",function(t,a){return{getContractOption:function(e,n){var l={},o=angular.extend(l,n);return{dropdownCssClass:"pub-apply-contract",dropdownAutoWidth:!0,id:function(t){return t.value},placeholder:a("translate")("SELECTTOSUGGEST_INPUT_AGREEMENT_NUMBER"),formatInputTooShort:function(t,e){return a("translate")("SELECTTOSUGGEST_PLACEINPUT")+" "+e+" "+a("translate")("SELECTTOSUGGEST_CHARACTERS")},query:function(a){var n={results:[]},l={},o={query:$.trim(a.term),customerNumber:e.basic.customerSelected.data};t({method:"get",url:"/data/applyContractSuggest.json",params:o}).success(function(t){200===t.code&&t.data&&t.data.length?(n.results=t.data,n.results.unshift(l),a.callback(n)):a.callback(n)})},formatNoMatches:function(){return a("translate")("SELECTTOSUGGEST_NO_AGREEMENT_NUMBER")},formatResult:function(t){return t.data?'<div class="bodyDrop"><span class="dropCol1">'+t.data.number+'</span><span class="dropCol2">'+a("translate")("CONTRACT_CATEGORY_"+t.data.category)+'</span><span class="dropCol3">'+a("translate")("CONTRACT_STATE_"+t.data.state)+'</span><span class="dropCol4">'+t.data.summary+"</span></div>":'<div class="headDrop"><span class="dropCol1">'+a("translate")("SELECTTOSUGGEST_CONTRACT_NUMBER")+'</span><span class="dropCol2">'+a("translate")("SELECTTOSUGGEST_CONTRACT_TYPE")+'</span><span class="dropCol3">'+a("translate")("STATUS")+'</span><span class="dropCol4">'+a("translate")("SELECTTOSUGGEST_SUMMARY")+"</span></div>"},formatSelection:function(t){return o&&o.formatSelectionCallback&&o.formatSelectionCallback(t),t.data?t.data.number:""},escapeMarkup:function(t){return t}}}}}])});