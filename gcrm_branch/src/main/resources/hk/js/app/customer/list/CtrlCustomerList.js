define(["app","../../_services/http/Country","../../_services/http/Customer","../../_directives/ytInputDropdown","../../_directives/ytPopoverConfirm","./SalesTransferModal","../AddAccountModal","anuglar-ui-select2"],function(e){e.registerController("CtrlCustomerList",["$scope","$log","$filter","$timeout","$window","PageSet","Modal","CustomerListConstant","Customer","Country","SalesTransferModal","AddAccountModal",function(e,t,n,o,a,r,s,u,c,i,l,g){function p(){u.get().then(function(t){e.queryTypes=t.queryTypes,e.approvalStatuses=t.approvalStatuses,e.customerTypes=t.customerTypes,e.agentRegions=t.agentRegions,o(function(){m()})})}function m(){var n=S();c.getList(n).success(function(n){if(200===n.code)try{e.customerList=n.data.content,e.pager.totalCount=n.data.totalCount,e.pager.totalPages=n.data.totalPages}catch(o){t.info(n)}else t.info(n)})}function S(){var t={},n=e.pager,o=e.qForm;return t.pageSize=n.pageSize,t.pageNumber=n.pageNumber,o.queryType&&(t.queryType=o.queryType.value,t.queryStr="SALES"===o.queryType.value?o.belongSales&&o.belongSales.name:"AGENT"===o.queryType.value?o.belongAgent&&o.belongAgent.id:o.queryString),t.approvalStatus=o.approvalStatus,t.customerType=o.customerType,t.agentRegional=o.agentRegion&&o.agentRegion.id,t.country=o.country&&o.country.id,t}function d(){e.pager.pageNumber=1}r.set({activeIndex:0,siteName:"customerList"}),e.qForm={},e.customerList=[],e.country=i.getSuggest(),e.belongSalesSuggestOption=c.getBelongSalesSuggestOption({allowClear:!0}),e.agentCompanySuggestOption=c.getAgentCompanySuggestOption({allowClear:!0}),e.$watch("qForm.queryType",function(t){t&&(e.qForm.belongSales=void 0,e.qForm.belongAgent=void 0,e.qForm.queryString="")}),e.queryMoreShow=!1,e.toggleQueryMore=function(){e.queryMoreShow=!e.queryMoreShow},e.pager={pageSize:10,pageSizeSlots:[10,20,30,50],pageNumber:1,totalCount:0},e.setPageSize=function(t){e.pager.pageSize=t,d(),m()},e.$watch("pager.pageNumber",function(e,t){e&&e!==t&&m()}),e.btnQuery=function(){d(),m()},e.checkDetail=function(e){var t;"saving"!==e.approvalStatusName||e.hasBeenApproved?(t="#/customer/detail?customerId="+e.id,a.open(t,"_blank")):(t="#/customer/add?customerId="+e.id,a.open(t,"_blank"))},e.salseTransfer=function(e){var t={customerId:e.id,companyName:e.companyName,belongSalesName:e.belongSalesName};l.show({customerData:t}).then(function(){m(),s.success({content:translateFilter("SUCCESS_SALES_TRANSFER"),timeOut:2e3})})},e.addAccount=function(e){var t={customerId:e.id,companyName:e.companyName,customerNumber:e.customerNumber};g.show({accountData:t}).then(function(e){200===e.code&&(s.success({content:translateFilter("SUCCESS_ACCOUNT_ADD"),timeOut:3e3}),m())})},e.sendReminder=function(e){c.sendReminder({customerId:e}).success(function(e){200===e.code&&s.success({content:translateFilter("SUCCESS_REMIDER"),timeOut:2e3})})},e.withdraw=function(e){c.withdraw({customerId:e}).success(function(e){200===e.code&&(m(),s.success({content:translateFilter("SUCCESS_WITHDRAW"),timeOut:2e3}))})},e.nullify=function(e){c.nullify({customerId:e}).success(function(e){200===e.code&&(m(),s.success({content:translateFilter("SUCCESS_NULLITY"),timeOut:2e3}))})},e.recover=function(e){c.recover({customer:{id:e}}).success(function(e){200===e.code&&(d(),m(),s.success({content:translateFilter("SUCCESS_RECOVERY"),timeOut:2e3}))})},p()}]),e.registerService("CustomerListConstant",["$q","$filter","$http","Customer",function(e,t,n,o){e.defer();return translateFilter=t("translate"),constant={queryTypes:[{i18nName:translateFilter("COMPANY_NAME"),value:"COMPANY"},{i18nName:translateFilter("BELONGING_SALES"),value:"SALES"},{i18nName:translateFilter("BELONGING_ANGENT_COMPANY"),value:"AGENT"},{i18nName:translateFilter("CUSTOMER_ANGENT_NUMBER"),value:"AGENT_CUSTOMER_NUMBER"}],approvalStatuses:[],customerTypes:[]},{get:function(){var t=e.defer();return o.getListQueryView().success(function(e){if(200===e.code){var n=e.data;constant.agentRegions=n.agentRegionals,constant.approvalStatuses=n.approveState,constant.customerTypes=n.customerTypes}t.resolve(constant)}),t.promise}}}])});