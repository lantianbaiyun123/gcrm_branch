define(["app","../_common/ytCommon","../_services/PageSet","../_services/http/Material","../_filters/MaterialApprovalStatusFilter","../_filters/PositionFilter","../_filters/AdSolutionStatusFilter","../_directives/periodLabel","../record/MaterialApprovalRecord","../record/MaterialModifyRecord"],function(a){a.registerController("CtrlMaterialApproval",["$scope","$state","$stateParams","$q","$log","$filter","PageSet","Modal","Material","MaterialApprovalRecord","MaterialModifyRecord",function(a,t,e,r,o,i,s,l,c,d,p){function n(){c.getApprovalInfo({id:a.taskRecord.foreignKey,activityId:a.taskRecord.activityId}).success(function(t){if(200===t.code)a.approvalInfo=t.data,a.updateTask();else if(200===t.code){var e="["+t.code+"]"+t.message+"\n";l.alert({content:e})}})}function f(){var t={adMaterialApplyId:a.taskRecord.materialId,taskId:a.taskRecord.taskId,activityId:a.taskRecord.activityId,approvalStatus:a.form.approvalStatus,approvalSuggestion:a.form.approvalSuggestion,processId:a.taskRecord.processId,actDefId:a.taskRecord.actDefId};return t}s.set({activeIndex:5,siteName:"task"}),a.taskRecord.materialId=e.materialId,a.taskRecord.foreignKey=e.materialId,a.taskRecord.activityId=e.activityId,a.taskRecord.type="approval",a.submitApproval=function(){if(a.submitDisabble=!0,a.checkApprovalStatus=!0,1!==a.form.approvalStatus&&0!==a.form.approvalStatus)return!1;if(0===a.form.approvalStatus&&(a.checkApprovalSuggestion=!0,!a.form.approvalSuggestion))return!1;var t=f(),e=c.submitApproval(t);e.success(function(){l.success({title:i("translate")("APPROVAL_AUDIT_OPINION_SUBMIT_SUCCESS"),content:i("translate")("APPROVAL_SYSTEM_JUMP"),timeOut:3e3},function(){a.goNextTask()})}),e["finally"](function(){a.submitDisabble=!1})},n(),a.modalApprovalRecord=function(){d.show(a.taskRecord.materialId,{windowClass:"material-approval-record"})},a.modalModifyRecord=function(){p.show(a.taskRecord.materialId,{windowClass:"matterial-modify-record"})}}])});