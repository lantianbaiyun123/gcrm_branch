define(["app","../_services/http/Material","../_filters/AdSolutionStatusFilter","../_filters/PositionFilter","../record/MaterialApprovalRecord","./MaterialEditModal","../_directives/ytPopoverConfirm","../_directives/periodLabel"],function(t){t.registerController("CtrlMaterialDetail",["$scope","$log","$stateParams","$filter","$q","$timeout","Modal","PageSet","Material","MaterialEditModal","MaterialApprovalRecord",function(t,e,a,i,n,l,o,s,r,c,d){function u(){m().then(function(){t.addEnable=!0,p()})}function p(){if(t.materialList)for(var e=t.materialList.length-1;e>=0;e--){var a=~~t.materialList[e].applyState;(0===a||1===a||4===a)&&t.toggleDetail(e)}}function f(e,a){c.show({saveType:e,adContentInfo:t.adContentInfo,materialData:a||{}},function(e){200===e.code&&(t.materialList=e.data.materialApplyVoList,p(),t.saveType=1,o.success({content:i("translate")("MATERIAL_SAVE_SUCCESS"),timeOut:3e3}))})}function m(){var e=n.defer();return r.getDetailInfo({contentId:t.materialInfo.contentId}).success(function(t){200===t.code&&(I(t.data),e.resolve())}),e.promise}function I(e){t.saveType=e.materialSaveType,t.adContentInfo=e.materialContentVo,t.materialList=e.materialApplyVoList}s.set({activeIndex:1,siteName:"materialDetail"}),t.materialInfo={},t.materialInfo.contentId=a.contentId,u(),t.toggleDetail=function(e){t.materialList[e].showDetail?t.materialList[e].showDetail=!t.materialList[e].showDetail:r.getDetail({applyId:t.materialList[e].applyId}).success(function(a){200===a.code&&(t.materialList[e].detail=a.data,t.materialList[e].showDetail=!t.materialList[e].showDetail)})},t.addMaterial=function(){f(t.saveType)},t.editMaterial=function(t){r.getDetail({applyId:t.applyId}).success(function(t){200===t.code&&f(2,t.data)})},t.recoverMaterial=function(t){r.getDetail({applyId:t.applyId}).success(function(t){200===t.code&&f(3,t.data)})},t.withdrawMaterial=function(e){r.withdraw({applyId:e}).success(function(e){200===e.code&&(t.materialList=e.data.materialApplyVoList,p(),t.saveType=1,o.success({content:i("translate")("MATERIAL_WITHDRAW_SUCCESS"),timeOut:3e3}))})},t.nullifyMaterial=function(t){r.nullify({applyId:t}).success(function(t){200===t.code&&(l(function(){I(t.data)}),o.success({content:i("translate")("MATERIAL_NULLIFY_SUCCESS"),timeOut:3e3}))})},t.sendReminder=function(t){r.sendReminder({applyId:t}).success(function(t){200===t.code&&o.success({content:i("translate")("SUCCESS_REMIDER"),timeOut:3e3})})},t.modalApprovalRecord=function(t){d.show(t)}}])});