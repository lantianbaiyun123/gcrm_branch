define(["app"],function(i){"use strict";i.registerFactory("highchartsNGUtils",function(){return{indexOf:function(i,n,t){void 0===t&&(t=0),0>t&&(t+=i.length),0>t&&(t=0);for(var e=i.length;e>t;t++)if(t in i&&i[t]===n)return t;return-1},prependMethod:function(i,n,t){var e=i[n];i[n]=function(){var i=Array.prototype.slice.call(arguments);return t.apply(this,i),e?e.apply(this,i):void 0}},deepExtend:function i(n,t){if(angular.isArray(t)){n=angular.isArray(n)?n:[];for(var e=0;e<t.length;e++)n[e]=i(n[e]||{},t[e])}else if(angular.isObject(t))for(var r in t)n[r]=i(n[r]||{},t[r]);else n=t;return n}}}).registerDirective("highchart",["highchartsNGUtils",function(i){var n=0,t=function(i){var t=!1;return angular.forEach(i,function(i){angular.isDefined(i.id)||(i.id="series-"+n++,t=!0)}),t},e=["xAxis","yAxis"],r=function(n,t,r){var a={},c={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:!1}};return a=r.options?i.deepExtend(c,r.options):c,a.chart.renderTo=t[0],angular.forEach(e,function(t){angular.isDefined(r[t])&&(a[t]=angular.copy(r[t]),(angular.isDefined(r[t].currentMin)||angular.isDefined(r[t].currentMax))&&(i.prependMethod(a.chart.events,"selection",function(i){var e=this;n.$apply(i[t]?function(){n.config[t].currentMin=i[t][0].min,n.config[t].currentMax=i[t][0].max}:function(){n.config[t].currentMin=e[t][0].dataMin,n.config[t].currentMax=e[t][0].dataMax})}),i.prependMethod(a.chart.events,"addSeries",function(){n.config[t].currentMin=this[t][0].min||n.config[t].currentMin,n.config[t].currentMax=this[t][0].max||n.config[t].currentMax})))}),r.title&&(a.title=r.title),r.subtitle&&(a.subtitle=r.subtitle),r.credits&&(a.credits=r.credits),r.size&&(r.size.width&&(a.chart.width=r.size.width),r.size.height&&(a.chart.height=r.size.height)),a},a=function(i,n){var t=i.getExtremes();(n.currentMin!==t.dataMin||n.currentMax!==t.dataMax)&&i.setExtremes(n.currentMin,n.currentMax,!1)},c=function(i,n,t){(n.currentMin||n.currentMax)&&i[t][0].setExtremes(n.currentMin,n.currentMax,!0)},o=function(i){return angular.extend({},i,{data:null,visible:null})};return{restrict:"EAC",replace:!0,template:"<div></div>",scope:{config:"="},link:function(n,s){var u={},f=function(e){var r,a=[];if(e){var c=t(e);if(c)return!1;if(angular.forEach(e,function(i){a.push(i.id);var n=d.get(i.id);n?angular.equals(u[i.id],o(i))?(void 0!==i.visible&&n.visible!==i.visible&&n.setVisible(i.visible,!1),n.setData(angular.copy(i.data),!1)):n.update(angular.copy(i),!1):d.addSeries(angular.copy(i),!1),u[i.id]=o(i)}),n.config.noData){var s=!1;for(r=0;r<e.length;r++)if(e[r].data&&e[r].data.length>0){s=!0;break}s?d.hideLoading():d.showLoading(n.config.noData)}}for(r=d.series.length-1;r>=0;r--){var f=d.series[r];i.indexOf(a,f.options.id)<0&&f.remove(!1)}return!0},d=!1,h=function(){d&&d.destroy(),u={};var i=n.config||{},t=r(n,s,i);d=i.useHighStocks?new Highcharts.StockChart(t):new Highcharts.Chart(t);for(var a=0;a<e.length;a++)i[e[a]]&&c(d,i[e[a]],e[a]);i.loading&&d.showLoading()};h(),n.$watch("config.series",function(i){var n=f(i);n&&d.redraw()},!0),n.$watch("config.title",function(i){d.setTitle(i,!0)},!0),n.$watch("config.subtitle",function(i){d.setTitle(!0,i)},!0),n.$watch("config.loading",function(i){i?d.showLoading():d.hideLoading()}),n.$watch("config.credits.enabled",function(i){i?d.credits.show():d.credits&&d.credits.hide()}),n.$watch("config.useHighStocks",function(i,n){i!==n&&h()}),angular.forEach(e,function(i){n.$watch("config."+i,function(n,t){n!==t&&n&&(d[i][0].update(n,!1),a(d[i][0],angular.copy(n)),d.redraw())},!0)}),n.$watch("config.options",function(i,n,t){i!==n&&(h(),f(t.config.series),d.redraw())},!0),n.$watch("config.size",function(i,n){i!==n&&i&&d.setSize(i.width||void 0,i.height||void 0)},!0),n.$on("highchartsng.reflow",function(){d.reflow()}),n.$on("$destroy",function(){d&&d.destroy(),s.remove()})}}}])});