define(["app"],function(e){e.registerDirective("ytPositionSelect",["$log","Position",function(e,t){return{scope:{positionSelected:"=",ytPositionSelect:"="},restrict:"A",templateUrl:"app/_directives/ytPositionSelect.tpl.html",replace:!0,link:function(i){function l(e){for(var t=i.q[e];t.next;)t=i.q[t.next],t.list=[],t.selected=angular.copy(t.all)}function n(e){switch(e){case"platform":t.getSiteList4Radio({productId:i.q[e].selected.id}).success(function(e){200===e.code&&(i.q.site.list=e.data,i.q.site.list.unshift(i.q.site.all))});break;case"site":t.getChannelList({productId:i.q.platform.selected.id,siteId:i.q[e].selected.id}).success(function(e){200===e.code&&(i.q.channel.list=e.data,i.q.channel.list.unshift(i.q.channel.all))});break;case"channel":t.getAreaList({parentId:i.q[e].selected.id}).success(function(e){200===e.code&&(i.q.area.list=e.data,i.q.area.list.unshift(i.q.area.all))});break;case"area":t.getPositionList({parentId:i.q[e].selected.id}).success(function(e){200===e.code&&(i.q.position.list=e.data,i.q.position.list.unshift(i.q.position.all))})}}function a(){var e={};for(var t in i.q)e[t]=angular.copy(i.q[t].selected);return e}{var s={level:5};angular.extend(s,i.ytPositionSelect)}t.getPlatformList4Radio().success(function(e){if(200===e.code){var t=angular.copy(e.data);t.unshift(i.q.platform.all),i.q.platform.list=t}i.positionSelected=a()}),i.setChoice=function(t,s){l(s);var c=i.q[s].list[t];i.q[s].selected=c,c.id?n(s):i.q[s].pre,i.positionSelected=a(),e.info(i.positionSelected)},i.q={platform:{all:{i18nName:"全部投放平台",id:null},list:[],selected:{i18nName:"全部投放平台",id:null},next:"site"},site:{all:{i18nName:"全部投放站点",id:null},list:[],selected:{i18nName:"全部投放站点",id:null},next:"channel",pre:"platform"},channel:{all:{i18nName:"全部频道",id:null},list:[],selected:{i18nName:"全部频道",id:null},next:"area",pre:"site"},area:{all:{i18nName:"全部区域",id:null},list:[],selected:{i18nName:"全部区域",id:null},next:"position",pre:"channel"},position:{all:{i18nName:"全部位置",id:null},list:[],selected:{i18nName:"全部位置",id:null},pre:"area"}}}}}])});