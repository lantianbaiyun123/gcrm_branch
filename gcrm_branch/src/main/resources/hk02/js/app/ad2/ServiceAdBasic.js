define(["app"],function(t){t.registerService("AdBasic",["$filter","$state","$stateParams","$timeout","AdHttp","CURRENT_USER_NAME","AdConstant",function(t,a,e,o,c,i,s){return{init:function(){},initView:function(t,a){t.state.basicReview=!0,a.account&&(t.basic.operatorSelected={data:a.account}),t.basic.customerSelected={data:a.customerI18nView.customer.customerNumber,value:a.customerI18nView.customer.companyName},t.basic.customerI18nView=a.customerI18nView,t.basic.contract={data:a.contract},t.contractTypes="offline"===t.basic.customerI18nView.customer.customerType?[{name:s.singleContract,type:"single"},{name:s.protocol,type:"protocol"}]:[{name:s.singleContract,type:"single"},{name:s.frame,type:"frame"}],t.basic.hasContract=a.hasContract||!!a.contract,t.basic.adSolution=a.adSolution,t.basic.solutionId=a.adSolution.id,t.basic.solutionNumber=a.adSolution.number,t.basic.solutionStatus=t.basic.adSolution.approvalStatus,t.basic.solutionType=t.basic.adSolution.type,t.basic.canWithdraw=a.canWithdraw,t.basic.canCreatePO=a.canCreatePO,t.basic.oldSolutionNumber=a.oldSolutionNumber,t.basic.oldSolutionContractType=a.oldSolutionContractType,t.basic.canUpdate=a.canUpdate,t.basic.isOwner=a.isOwner,a.adSolution&&a.adSolution.taskInfo&&(t.alerts=[{type:"info",msg:a.adSolution.taskInfo}],"refused"===a.adSolution.approvalStatus&&(t.alerts[0].type="danger"))},initAdd:function(t){t.basic.hasContract=!1,t.basic.adProjectStatus=1,t.basic.operatorSelected={data:{ucid:i.ucid,name:i.realname}},t.basic.solutionStatus="saving",t.basic.solutionType="create",t.basic.isOwner=!0,e.customerNumber&&Customer.get({customerNumber:e.customerNumber,companyName:""}).success(function(a){t.basic.customerI18nView=a.data,t.basic.customerSelected={data:a.data.customer.customerNumber,value:a.data.customer.companyName},"nondirect"===a.data.customer.customerType&&(t.basic.customerSelected={data:a.data.customer.customerNumber,value:a.data.agentCompany.companyName})})},edit:function(t){return t.solutionId?(t.state.basicReview=!1,t.state.isGlobleEditing=!0,void(t.state.showBasicCancel=!0)):!1},resetBasic:function(t){c.basicGetEdit({id:t.solutionId}).success(function(a){200===a.code&&(t.basic.operatorSelected={data:{ucid:a.data.operatorId,name:a.data.operatorName}},t.basic.customerSelected={data:a.data.customerI18nView.customer.customerNumber,value:a.data.customerI18nView.customer.companyName},t.basic.customerI18nView=a.data.customerI18nView,o(function(){t.basic.contract={data:a.data.contract},t.basic.hasContract=a.data.hasContract,t.state.basicReview=!0,t.state.isGlobleEditing=!1},0))})},save:function(t){var o=this;c.basicSave({hasContract:t.basic.hasContract,advertiseSolutionView:{advertiseSolution:{id:t.basic.solutionId,contractNumber:t.basic.contract&&t.basic.contract.data.number,customerNumber:t.basic.customerSelected.data,operator:t.basic.operatorSelected.data.ucid}}}).success(function(c){if(200===c.code){var i=c.data.advertiseSolutionView.advertiseSolution.id;t.solutionId=i,e.id?(o.resetBasic(t),o.updateDirect(t)):(e.id=i,a.transitionTo(a.current,e,{reload:!0,inherit:!1,notify:!1}))}})},updateDirect:function(t){if(t.basic.customerDirect=function(){var a=!1;return"direct"===t.basic.customerI18nView.customer.customerType&&(a={data:t.basic.customerI18nView.customer.customerNumber,value:t.basic.customerI18nView.customer.companyName}),a}(),t.basic.customerDirect&&t.adContents.length)for(var a=t.adContents.length-1;a>=0;a--){var e=t.adContents[a];e.advertiser=angular.copy(t.basic.customerDirect),e.adSolutionContent.advertiser=t.basic.customerI18nView.customer.companyName}}}}])});