define(["app","../_services/http/Customer","../_directives/ytFocusme"],function(e){e.registerFactory("AddAccountModal",["$q","$modal","STATIC_DIR",function(e,t,a){return{show:function(c){var o=e.defer(),n={},u=t.open({templateUrl:a+"app/customer/addAccountModal.tpl.html",controller:"CtrlAddAccount",windowClass:"modal-lg",backdrop:"static",resolve:{opts:function(){return angular.extend(n,c)}}});return u.result.then(function(e){"close"===e.btnType&&o.resolve(),"ok"===e.btnType&&o.resolve(e.response)}),o.promise}}}]),e.registerController("CtrlAddAccount",["$scope","$log","$modalInstance","$filter","$q","Utils","Customer","opts",function(e,t,a,c,o,n,u,s){e.accountData=s.accountData,e.verifiedStatus=s.accountData.verifiedStatus,e.cancel=function(){a.dismiss("cancel")},e.close=function(){a.close({btnType:"close"})},e.validateEmail=function(){var t=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}$/;t.test(e.accountData.email)&&u.validateEmail({customerNumber:e.accountData.customerNumber,email:e.accountData.email,accountId:e.accountData.accountId}).success(function(t){200===t.code&&(e.verifiedStatus=t.data.status,e.accountData.accountId=t.data.accountId,e.accountData.verCode=t.data.verifyCode)})},e.emailChanged=function(){e.verifiedStatus=0,e.accountData.verCode=""},e.next=function(){e.nextDisabled=!0,u.validateVerCode({customerNumber:e.accountData.customerNumber,email:e.accountData.email,accountId:e.accountData.accountId,verifyCode:e.accountData.verCodeInput}).success(function(t){200===t.code&&(e.verifiedStatus="VERIFIED"),e.nextDisabled=!1})},e.ok=function(){e.submitDisabled=!0;var t=/^[a-zA-Z0-9]{3,}$/;if(t.test(e.accountData.userName)){var c=u.submitUserName({customerNumber:e.accountData.customerNumber,email:e.accountData.email,accountId:e.accountData.accountId,username:e.accountData.userName});c.success(function(t){200===t.code?(e.newUserName=t.data.username,a.close({btnType:"ok",response:t})):206===t.code&&(e.isUserNameError=!0,e.userNameErrorText=t.message,e.userNameFocus={focus:!0})}),c["finally"](function(){e.submitDisabled=!1})}else e.submitDisabled=!1},e.resetDuplication=function(){e.isUserNameError=!1}}])});