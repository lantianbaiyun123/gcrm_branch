define(["app"],function(t){t.registerController("CtrlCustomerOpportunity",["$scope","$state","$stateParams","$timeout","Modal","CtrlCustomerOpportunityPlatform",function(t,n,o,e,r,i){t.opportunity=t.opportunity||{},t.opportunity.payTypes=["advance","after"],t.opportunity.billingModels=["CPC","CPS","CPA","CPM","CPT"],t.$watch("opportunity.businessTypesSelected",function(n){n&&i.updatePlatforms(n).then(function(n){t.opportunity.platforms=n})},!0),t.btnEdit=function(){t.tempOpportunity=angular.copy(t.opportunity),t.opportunity.state="detailEditing"},t.btnCancel=function(){angular.extend(t.opportunity,t.tempOpportunity,{state:"detailViewing"})},t.btnSave=function(){t.$emit("opportunitySave")}}]),t.registerService("CtrlCustomerOpportunityPlatform",["$q","Position",function(t,n){function o(t){for(var o=[],e=0;e<t.length;e++)r[t[e]]||o.push(n.getPlatformListByBusinessType({businessType:t[e]}));return o}function e(t){var n=[];for(var o in r)-1!==t.indexOf(o)&&(n=n.concat(r[o]));return n}var r={};return{updatePlatforms:function(n){var i=t.defer();return t.all(o(n)).then(function(t){for(var o=0,p=0;p<n.length;p++)r[n[p]]||(r[n[p]]=t[o].data.data,o+=1);i.resolve(e(n))}),i.promise}}}])});