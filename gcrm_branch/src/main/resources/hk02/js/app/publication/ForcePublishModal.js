define(["app","../_services/http/Publication","../_directives/ytJqueryFileUpload","../_directives/ytAjaxupload","../_directives/ytPlaceholder"],function(t){t.registerFactory("ForcePublishModal",["$modal","Publication","STATIC_DIR",function(t,e,a){return{show:function(e,n){var o={},l=t.open({templateUrl:a+"app/publication/forcePublishModal.tpl.html",controller:"CtrlForcePublish",windowClass:"force-publish-modal",backdrop:"static",resolve:{opts:function(){return angular.extend(o,e)}}});l.result.then(function(t){"ok"===t.btnType&&n(t.response)})}}}]),t.registerController("CtrlForcePublish",["$scope","$log","$modalInstance","$filter","$q","Utils","Publication","opts",function(t,e,a,n,o,l,i,r){function c(){var e=t.certData.certType;return isGood=!0,"online_approval"===e?isGood=s():"offline_attachment"===e&&(isGood=p()),isGood}function s(){return t.checkingUrl=!0,!!t.certData.processUrl&&l.urlValidator(t.certData.processUrl)}function p(){return t.checkAttachment=!0,!!t.certData.attachments.length}function u(){var e=[],a=t.certData;if("online_approval"===a.certType)e.push({type:"online_approval",approvalUrl:a.processUrl});else if("offline_attachment"===a.certType){e.attachments=angular.copy(a.attachments);for(var n=a.attachments.length-1;n>=0;n--)e.push({type:"offline_attachment",fileUrl:a.attachments[n].fileUrl,downloadFilename:a.attachments[n].downloadFileName,uploadFilename:a.attachments[n].uploadFileName})}else e.push({type:"none"});return e}t.title=r.title,e.info(r),t.certData={},t.certData.id=r.periodId,t.certData.certType="online_approval",t.certData.attachments=[],t.attachmentUploadOpts={uploadedText:n("translate")("UPLOAD_ATTACHMENT"),formatErrorText:"UPLOAD_FILE_TYPE_FORBIDDEN"},t.beginUpload=function(){t.submitDisabled=!0},t.uploaded=function(){t.submitDisabled=!1},t.removeAttachment=function(e){t.certData.attachments.splice(e,1)},t.cancel=function(){a.dismiss("cancel")},t.ok=function(){if(t.submitDisabled=!0,c()){var e=u(),n=i.forcePublish({id:t.certData.id,proofList:e});n.success(function(t){200===t.code&&a.close({btnType:"ok",response:t})}),n["finally"](function(){t.submitDisabled=!1})}else t.submitDisabled=!1}}])});