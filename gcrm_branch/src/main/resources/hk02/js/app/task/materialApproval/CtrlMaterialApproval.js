define(["app","../../_common/ytCommon","../../_services/PageSet","../../_services/http/Material","../../_filters/PositionFilter","../../_filters/AdSolutionStatusFilter","../../_directives/periodLabel","../../record/MaterialApprovalRecord","../../record/MaterialModifyRecord"],function(t){t.registerController("CtrlMaterialApproval",["$scope","$state","$stateParams","$q","$log","$filter","PageSet","Modal","Material","MaterialApprovalRecord","MaterialModifyRecord",function(t,a,e,o,r,i,s,c,d,l,p){function n(){d.getApprovalInfo({id:t.taskRecord.foreignKey,activityId:t.taskRecord.activityId}).success(function(a){if(200===a.code)t.approvalInfo=a.data,t.updateTask();else if(200===a.code){var e="["+a.code+"]"+a.message+"\n";c.alert({content:e})}else t.updateTask()})}function u(){var a={adMaterialApplyId:t.taskRecord.materialId,taskId:t.taskRecord.taskId,activityId:t.taskRecord.activityId,approvalStatus:t.form.approvalStatus,approvalSuggestion:t.form.approvalSuggestion,processId:t.taskRecord.processId,actDefId:t.taskRecord.actDefId};return a}s.set({activeIndex:5,siteName:"task"}),t.taskRecord.materialId=e.materialId,t.taskRecord.foreignKey=e.materialId,t.taskRecord.activityId=e.activityId,t.taskRecord.type="approval",t.submitApproval=function(){if(t.submitDisabble=!0,t.checkApprovalStatus=!0,1!==t.form.approvalStatus&&0!==t.form.approvalStatus)return!1;if(0===t.form.approvalStatus&&(t.checkApprovalSuggestion=!0,!t.form.approvalSuggestion))return!1;var a=u(),e=d.submitApproval(a);e.success(function(a){200===a.code&&c.success({title:i("translate")("APPROVAL_AUDIT_OPINION_SUBMIT_SUCCESS"),content:i("translate")("APPROVAL_SYSTEM_JUMP"),timeOut:3e3},function(){t.goNextTask()})}),e["finally"](function(){t.submitDisabble=!1})},n(),t.modalApprovalRecord=function(){l.show(t.taskRecord.materialId)},t.modalModifyRecord=function(){p.show(t.taskRecord.materialId)}}])});