define(["app","../../_common/ytCommon","../../_services/PageSet","../../_services/http/AdProgram","../../_filters/AdSolutionTypeFilter","../../_filters/RecordOperateTypeFilter","../../_filters/PriceTypeFilter","../../_filters/AdMaterialIfEmbedCodeFilter","../../_filters/BoolValueFilter","../../_filters/IndustryTypeFilter","../../_filters/urlHttpFilter","../../resourcePosition/PositionPropDetailModal","../../_directives/periodLabel","./ScheduleModal"],function(o){o.registerController("CtrlSchedule",["$scope","$state","$stateParams","$timeout","$location","$anchorScroll","$modal","$filter","PageSet","Modal","Utils","AdProgram","ScheduleModal",function(o,t,e,n,a,i,s,r,l,d,c,p,u){function I(){var t={processInfo:{activityId:o.taskRecord.activityId,processId:o.taskRecord.processId},positionInfo:{adContentId:o.solutionInfo.approvalContentViews[0].adSolutionContent.id,positionId:o.solutionInfo.approvalContentViews[0].adSolutionContent.positionId,advertiser:o.solutionInfo.approvalContentViews[0].adSolutionContent.advertiser,productName:o.solutionInfo.approvalContentViews[0].adSolutionContent.productName,siteName:o.solutionInfo.approvalContentViews[0].adSolutionContent.siteName,channelName:o.solutionInfo.approvalContentViews[0].adSolutionContent.channelName,areaName:o.solutionInfo.approvalContentViews[0].adSolutionContent.areaName,positionName:o.solutionInfo.approvalContentViews[0].adSolutionContent.positionName,salesAmount:o.solutionInfo.approvalContentViews[0].position.salesAmount,rotationType:o.solutionInfo.approvalContentViews[0].position.rotationType},nextAlways:!0};return t}l.set({activeIndex:5,siteName:"task"}),e.adSolutionId&&(o.taskRecord.adSolutionId=e.adSolutionId.split("_")[0]),o.taskRecord.foreignKey=e.adSolutionId,o.taskRecord.activityId=e.activityId,o.taskRecord.processId=e.processId,o.taskRecord.type="operation",o.solutionInfo=o.solutionInfo||{},o.taskRecord.adSolutionId&&o.taskRecord.activityId&&o.taskRecord.processId?p.scheduleInfoGet({id:o.taskRecord.foreignKey,activityId:o.taskRecord.activityId,processId:o.taskRecord.processId},function(t){if(200===t.code)o.solutionInfo=t.data,o.updateTask();else if(t.code>250){var e="["+t.code+"]"+t.message;d.alert({content:e})}else o.updateTask()}):o.updateTask(!0),o.makeSchedule=function(){var t=I();u.show(t,function(){d.success({title:r("translate")("SCHEDULE_SUBMIT_SUCCESS"),content:r("translate")("SCHEDULE_SYSTEM_JUMP"),timeOut:3e3},function(){o.goNextTask()})})}}])});